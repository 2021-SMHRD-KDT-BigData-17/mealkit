<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="database.mapper1">

	<resultMap type="domain.Order" id="order">
		<result column="order_status" property="order_status"/>
		<association property="orderDetail" javaType="domain.OrderDetail">
			<result column="prod_count" property="prod_count"/>
		</association>
		<association property="product" javaType="domain.Product">
			<result column="prod_name" property="prod_name"/>
			<result column="prod_imag1" property="prod_imag1"/>
			<result column="prod_price" property="prod_price"/>
		</association>
	</resultMap>



	<select id="signUpCheckId" parameterType="domain.User" resultType="domain.User">
		select user_id from
		tbl_user where user_id =#{user_id}
	</select>

	<insert id="signUp" parameterType="domain.User">
		insert into tbl_user
		values(#{user_id},#{user_pw},#{user_name},#{user_nick},#{user_gender},#{user_addr},#{user_phone},#{user_point,
		jdbcType=INTEGER},SYSDATE,#{user_type})
	</insert>

	<select id="signIn" parameterType="domain.User"
		resultType="domain.User">
		select user_id, user_nick from tbl_user where
		user_id=#{user_id} and user_pw=#{user_pw}
	</select>
	
	<select id="loadUser" parameterType="String" resultType="domain.User">
		select user_name, user_point from tbl_user where user_id=#{ID}
	</select>

	<insert id="insertDelivery" parameterType="domain.Delivery">
		insert into
		tbl_delivery
		values(#{order_seq},#{deli_addr},#{deli_name},#{deli_name},#{deli_phone},#{deli_company},SYSDATE)
	</insert>

	<delete id="deleteDelivery" parameterType="int">
		delete from
		tbl_delivery where deli_seq=#{deli_seq}
	</delete>

	<insert id="insertOrder" parameterType="domain.Order">
		insert into tbl_order
		values
		(#{user_id},SYSDATE,#{total_amount},#{order_status},#{dicount_amount},#{pay_amount},#{pay_method},#{paid_amount})
	</insert>

	<delete id="deleteOrder" parameterType="int">
		delete from tbl_order
		where order_seq=#{order_seq}
	</delete>
	
	<select id="loadOrder" parameterType="String" resultMap="order">
		select tbl_product.prod_name, tbl_product.prod_imag1, tbl_product.prod_price, TBLL.prod_count, TBLL.order_status from ((select * from tbl_order where user_id=#{ID}) TBL inner join tbl_orderdetail on TBL.order_seq = tbl_orderdetail.order_seq) TBLL inner join tbl_product on tbl_product.prod_code = TBLL.product_code
	</select>

	<select id="loadProduct" parameterType="int" resultType="domain.Product">
		select * from tbl_product
		where prod_code=#{prod_code}
	</select>
	
</mapper>